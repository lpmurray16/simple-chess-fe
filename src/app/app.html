<div class="app-container" [class.native-platform]="isNative">
    <header class="d-flex justify-content-between align-items-center">
        <h2 class="title">Wizard's Chess</h2>

        @if (gameService.gameState$ | async; as gameState) {
        <p class="game-status">{{ gameState.status }}</p>
        }

        <div class="header-actions d-flex align-items-center">
            @if (auth.currentUser$ | async; as user) {
            <div class="notification-wrapper me-3" (click)="toggleMessages()">
                <i class="fa-solid fa-bell bell-icon mr-3"></i>
                @if (messageService.hasNewMessages$ | async) {
                <span class="indicator"></span>
                }
            </div>

            <button class="hamburger-btn" (click)="toggleMenu()" [class.open]="menuOpen" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <div class="user-menu" [class.open]="menuOpen">
                <span class="user-email mb-4">{{ user.email }}</span>
                <button class="btn btn-sm btn-default logout-btn" (click)="logout()">Logout</button>
                <button class="btn btn-sm btn-danger reset-btn mt-4" (click)="resetGame()">Reset Game</button>
                @if (isAdmin) {
                <button class="btn btn-sm btn-danger mt-4" (click)="clearMessages()">
                    <i class="fa-solid fa-trash-can mr-2"></i> Clear Messages
                </button>
                }
                <button class="btn btn-sm btn-default history-btn mt-4" (click)="toggleHistory()">
                    <i class="fa-solid fa-clock-rotate-left mr-2"></i> Game History
                </button>
            </div>
            } @else {
            <button class="btn btn-primary btn-sm" (click)="toggleAuth()">Login / Signup</button>
            }
        </div>
    </header>

    <main>
        <app-board></app-board>
        <app-overlay></app-overlay>

        @if (showAuth && !(auth.currentUser$ | async)) {
        <div class="auth-overlay">
            <div class="auth-modal">
                @if (auth.currentUser$ | async) {
                <button class="close-btn" (click)="toggleAuth()">&times;</button>
                }
                <app-login-signup></app-login-signup>
            </div>
        </div>
        }

        @if (showMessages) {
        <app-message-modal (close)="showMessages = false"></app-message-modal>
        }

        @if (showHistory) {
        <app-game-history-modal (close)="toggleHistory()"></app-game-history-modal>
        }

        @if (showResetConfirmation) {
        <div class="auth-overlay">
            <div class="auth-modal">
                <h3>Reset Board?</h3>
                <p>Are you sure you want to reset the game? This will clear the board for everyone.</p>
                <div class="modal-actions d-flex gap-2 justify-content-end mt-3">
                    <button class="btn btn-danger" (click)="confirmReset()">Reset</button>
                    <button class="btn btn-default" (click)="cancelReset()">Cancel</button>
                </div>
            </div>
        </div>
        }
    </main>
</div>